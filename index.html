<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gyertyagy√°rt√°s K√∂vet≈ë</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-50 min-h-screen p-4">
    <div id="app" class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-amber-900 mb-2">üïØÔ∏è Gyertyagy√°rt√°s K√∂vet≈ë</h1>
                    <p class="text-amber-700">K√∂vesd nyomon a ki√∂nt√∂tt illatokat √©s a sz√ºks√©ges c√≠mk√©ket</p>
                </div>
                <button onclick="toggleBeallitasok()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition text-sm">
                    ‚öôÔ∏è Be√°ll√≠t√°sok
                </button>
            </div>
        </div>

        <!-- Be√°ll√≠t√°sok modal -->
        <div id="beallitasokModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-amber-900">‚öôÔ∏è Be√°ll√≠t√°sok</h2>
                        <button onclick="toggleBeallitasok()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
                    </div>

                    <div class="space-y-6">
                        <!-- Gyertya m√©retek -->
                        <div class="border-2 border-amber-200 rounded-lg p-4">
                            <h3 class="font-bold text-lg text-amber-900 mb-3">Gyertya m√©retek</h3>
                            <div id="gyertyaMeretLista" class="space-y-2 mb-3"></div>
                            <div class="flex gap-2">
                                <input type="text" id="ujGyertyaMeret" placeholder="pl. XL (500g)" class="flex-1 px-3 py-2 border rounded-lg">
                                <button onclick="meretHozzaad('gyertya')" class="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700">+ Hozz√°ad</button>
                            </div>
                        </div>

                        <!-- Spray m√©retek -->
                        <div class="border-2 border-blue-200 rounded-lg p-4">
                            <h3 class="font-bold text-lg text-blue-900 mb-3">Room and Linen Spray m√©retek</h3>
                            <div id="sprayMeretLista" class="space-y-2 mb-3"></div>
                            <div class="flex gap-2">
                                <input type="text" id="ujSprayMeret" placeholder="pl. 500ml" class="flex-1 px-3 py-2 border rounded-lg">
                                <button onclick="meretHozzaad('spray')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">+ Hozz√°ad</button>
                            </div>
                        </div>

                        <!-- Diffuser m√©retek -->
                        <div class="border-2 border-green-200 rounded-lg p-4">
                            <h3 class="font-bold text-lg text-green-900 mb-3">Reed Diffuser m√©retek</h3>
                            <div id="diffuserMeretLista" class="space-y-2 mb-3"></div>
                            <div class="flex gap-2">
                                <input type="text" id="ujDiffuserMeret" placeholder="pl. 1000ml" class="flex-1 px-3 py-2 border rounded-lg">
                                <button onclick="meretHozzaad('diffuser')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">+ Hozz√°ad</button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button onclick="toggleBeallitasok()" class="bg-amber-600 text-white px-6 py-2 rounded-lg hover:bg-amber-700 font-semibold">
                            Bez√°r√°s
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6 mb-6">
            <!-- Illatok kezel√©se -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-amber-900">Illatok</h2>
                    <button onclick="toggleUjIllat()" class="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition text-sm">
                        + √öj illat
                    </button>
                </div>

                <div id="ujIllatForm" class="mb-4 p-4 bg-amber-50 rounded-lg hidden">
                    <input
                        type="text"
                        id="ujIllatNev"
                        placeholder="Illat neve (pl. Van√≠lia)"
                        class="w-full px-4 py-2 border border-amber-300 rounded-lg mb-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                    />
                    <div class="flex gap-2">
                        <button onclick="illatHozzaad()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition flex-1">
                            Hozz√°ad
                        </button>
                        <button onclick="toggleUjIllat()" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition">
                            M√©gsem
                        </button>
                    </div>
                </div>

                <div id="illatLista" class="space-y-2 max-h-96 overflow-y-auto"></div>
            </div>

            <!-- √öj term√©k r√∂gz√≠t√©se -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-amber-900 mb-4">√öj term√©k r√∂gz√≠t√©se</h2>
                
                <div id="kiontesForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Term√©k t√≠pus</label>
                        <select id="termekTipus" onchange="updateMeretOptions()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent">
                            <option value="">V√°lassz term√©k t√≠pust...</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">M√©ret</label>
                        <select id="meret" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent">
                            <option value="">El≈ësz√∂r v√°lassz term√©k t√≠pust</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Illat</label>
                        <select id="kivalasztottIllat" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent">
                            <option value="">V√°lassz illatot...</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Darabsz√°m</label>
                        <input
                            type="number"
                            id="darabszam"
                            min="1"
                            placeholder="H√°ny darabot k√©sz√≠tett√©l?"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Megjegyz√©s (opcion√°lis)</label>
                        <input
                            type="text"
                            id="megjegyzes"
                            placeholder="pl. k√ºl√∂nleges sorozat, aj√°nd√©k csomag"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                        />
                    </div>

                    <button onclick="kiontesHozzaad()" class="w-full bg-amber-600 text-white px-6 py-3 rounded-lg hover:bg-amber-700 transition font-semibold">
                        Term√©k r√∂gz√≠t√©se
                    </button>
                </div>
            </div>
        </div>

        <!-- C√≠mke √∂sszes√≠t√©s -->
        <div id="cimkeOsszesites" class="mb-6"></div>

        <!-- C√≠mke nyomtat√°s -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-amber-900 mb-4">üñ®Ô∏è C√≠mke nyomtat√°s (12 db / lap)</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Gyors nyomtat√°s lista -->
                <div>
                    <h3 class="font-semibold text-gray-700 mb-3">Gyors nyomtat√°s (ki√∂nt√∂tt term√©kek alapj√°n)</h3>
                    <div id="gyorsNyomtatasLista" class="space-y-2 max-h-96 overflow-y-auto"></div>
                </div>

                <!-- C√≠mke k√©szlet -->
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="font-bold text-blue-900 mb-3">üì¶ C√≠mke k√©szlet</h3>
                    <div id="cimkeKeszletLista" class="space-y-2 max-h-96 overflow-y-auto"></div>
                </div>
            </div>
        </div>

        <!-- K√©sz term√©kek -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-amber-900 mb-4">‚úÖ K√©sz c√≠mk√©zett term√©kek</h2>
            <div id="keszTermekekLista" class="space-y-3 max-h-96 overflow-y-auto"></div>
        </div>

        <!-- Term√©kek list√°ja -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-amber-900 mb-4">Term√©kek t√∂rt√©nete</h2>
            <div id="kiontesLista" class="space-y-3 max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        let illatok = [];
        let kiontesek = [];
        let cimkeKeszlet = {}; // C√≠mke k√©szlet t√°rol√°sa: { "illatId-termekTipus-meret": darabszam }
        let keszTermekek = []; // C√≠mk√©zett k√©sz term√©kek
        let idCounter = 0; // Egyedi ID sz√°ml√°l√≥
        
        // Term√©k t√≠pusok √©s m√©retek
        const termekTipusok = [
            { id: 'gyertya', nev: 'Gyertya' },
            { id: 'spray', nev: 'Room and Linen Spray' },
            { id: 'diffuser', nev: 'Reed Diffuser' }
        ];
        
        // Alap√©rtelmezett m√©retek
        const alapMeretek = {
            gyertya: ['Kis (120g)', 'K√∂zepes (180g)', 'Nagy (250g)', 'Extra nagy (400g)'],
            spray: ['50ml', '100ml', '250ml'],
            diffuser: ['100ml', '200ml', '500ml']
        };
        
        let meretek = {};
        
        // Egyedi ID gener√°l√°s
        function generateId() {
            return Date.now() + (idCounter++);
        }

        // LocalStorage bet√∂lt√©s
        function betolt() {
            const mentettIllatok = localStorage.getItem('gyertya_illatok');
            const mentettKiontesek = localStorage.getItem('gyertya_kiontesek');
            const mentettMeretek = localStorage.getItem('gyertya_meretek');
            const mentettCimkeKeszlet = localStorage.getItem('gyertya_cimke_keszlet');
            const mentettKeszTermekek = localStorage.getItem('gyertya_kesz_termekek');
            
            if (mentettIllatok) illatok = JSON.parse(mentettIllatok);
            if (mentettKiontesek) kiontesek = JSON.parse(mentettKiontesek);
            if (mentettMeretek) {
                meretek = JSON.parse(mentettMeretek);
            } else {
                // Ha nincs mentett, haszn√°ljuk az alap√©rtelmezett m√©reteket
                meretek = JSON.parse(JSON.stringify(alapMeretek));
            }
            if (mentettCimkeKeszlet) cimkeKeszlet = JSON.parse(mentettCimkeKeszlet);
            if (mentettKeszTermekek) keszTermekek = JSON.parse(mentettKeszTermekek);
            
            render();
        }

        // LocalStorage ment√©s
        function ment() {
            localStorage.setItem('gyertya_illatok', JSON.stringify(illatok));
            localStorage.setItem('gyertya_kiontesek', JSON.stringify(kiontesek));
            localStorage.setItem('gyertya_meretek', JSON.stringify(meretek));
            localStorage.setItem('gyertya_cimke_keszlet', JSON.stringify(cimkeKeszlet));
            localStorage.setItem('gyertya_kesz_termekek', JSON.stringify(keszTermekek));
        }

        function toggleBeallitasok() {
            const modal = document.getElementById('beallitasokModal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                renderBeallitasok();
            }
        }

        function renderBeallitasok() {
            // Gyertya m√©retek
            const gyertyaLista = document.getElementById('gyertyaMeretLista');
            if (gyertyaLista) {
                gyertyaLista.innerHTML = '';
                meretek.gyertya.forEach((m, idx) => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 bg-amber-50 rounded';
                    
                    const span = document.createElement('span');
                    span.textContent = m;
                    
                    const button = document.createElement('button');
                    button.textContent = 'T√∂rl√©s';
                    button.className = 'text-red-600 hover:text-red-800 text-sm';
                    button.onclick = () => meretTorol('gyertya', idx);
                    
                    div.appendChild(span);
                    div.appendChild(button);
                    gyertyaLista.appendChild(div);
                });
            }

            // Spray m√©retek
            const sprayLista = document.getElementById('sprayMeretLista');
            if (sprayLista) {
                sprayLista.innerHTML = '';
                meretek.spray.forEach((m, idx) => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 bg-blue-50 rounded';
                    
                    const span = document.createElement('span');
                    span.textContent = m;
                    
                    const button = document.createElement('button');
                    button.textContent = 'T√∂rl√©s';
                    button.className = 'text-red-600 hover:text-red-800 text-sm';
                    button.onclick = () => meretTorol('spray', idx);
                    
                    div.appendChild(span);
                    div.appendChild(button);
                    sprayLista.appendChild(div);
                });
            }

            // Diffuser m√©retek
            const diffuserLista = document.getElementById('diffuserMeretLista');
            if (diffuserLista) {
                diffuserLista.innerHTML = '';
                meretek.diffuser.forEach((m, idx) => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 bg-green-50 rounded';
                    
                    const span = document.createElement('span');
                    span.textContent = m;
                    
                    const button = document.createElement('button');
                    button.textContent = 'T√∂rl√©s';
                    button.className = 'text-red-600 hover:text-red-800 text-sm';
                    button.onclick = () => meretTorol('diffuser', idx);
                    
                    div.appendChild(span);
                    div.appendChild(button);
                    diffuserLista.appendChild(div);
                });
            }
        }

        function meretHozzaad(tipus) {
            const inputId = `uj${tipus.charAt(0).toUpperCase() + tipus.slice(1)}Meret`;
            const input = document.getElementById(inputId);
            const ujMeret = input.value.trim();
            
            if (ujMeret) {
                meretek[tipus].push(ujMeret);
                input.value = '';
                ment();
                renderBeallitasok();
                render(); // Friss√≠tj√ºk a f≈ë n√©zetet is
            }
        }

        function meretTorol(tipus, index) {
            if (confirm('Biztosan t√∂rl√∂d ezt a m√©retet?')) {
                meretek[tipus].splice(index, 1);
                ment();
                renderBeallitasok();
                render(); // Friss√≠tj√ºk a f≈ë n√©zetet is
            }
        }

        function updateNyomtatasMeretOptions() {
            const termekTipus = document.getElementById('nyomtatasTermekTipus').value;
            const meretSelect = document.getElementById('nyomtatasMeret');
            
            if (termekTipus && meretek[termekTipus]) {
                meretSelect.innerHTML = '<option value="">V√°lassz m√©retet...</option>' +
                    meretek[termekTipus].map(m => `<option value="${m}">${m}</option>`).join('');
            } else {
                meretSelect.innerHTML = '<option value="">El≈ësz√∂r v√°lassz term√©k t√≠pust</option>';
            }
        }

        function getCimkeKulcs(illatId, termekTipus, meret) {
            return `${illatId}-${termekTipus}-${meret}`;
        }

        function gyorsNyomtatas(illatId, termekTipus, meret) {
            const inputId = `lapok-${illatId}-${termekTipus}-${meret}`;
            const lapokInput = document.getElementById(inputId);
            const lapok = parseInt(lapokInput.value);
            
            if (!lapok || lapok < 1) {
                alert('K√©rlek adj meg egy √©rv√©nyes lap sz√°mot!');
                return;
            }
            
            const kulcs = getCimkeKulcs(illatId, termekTipus, meret);
            const cimkeDarab = lapok * 12;
            
            if (!cimkeKeszlet[kulcs]) {
                cimkeKeszlet[kulcs] = 0;
            }
            cimkeKeszlet[kulcs] += cimkeDarab;
            
            ment();
            render();
            
            alert(`${cimkeDarab} db c√≠mke (${lapok} lap) hozz√°adva a k√©szlethez!`);
        }

        function cimkeNyomtatasRogzit() {
            const termekTipus = document.getElementById('nyomtatasTermekTipus').value;
            const meret = document.getElementById('nyomtatasMeret').value;
            const illatId = parseInt(document.getElementById('nyomtatasIllat').value);
            const lapok = parseInt(document.getElementById('nyomtatottLapok').value);
            
            if (termekTipus && meret && illatId && lapok > 0) {
                const kulcs = getCimkeKulcs(illatId, termekTipus, meret);
                const cimkeDarab = lapok * 12;
                
                if (!cimkeKeszlet[kulcs]) {
                    cimkeKeszlet[kulcs] = 0;
                }
                cimkeKeszlet[kulcs] += cimkeDarab;
                
                document.getElementById('nyomtatasTermekTipus').value = '';
                document.getElementById('nyomtatasMeret').innerHTML = '<option value="">El≈ësz√∂r v√°lassz term√©k t√≠pust</option>';
                document.getElementById('nyomtatasIllat').value = '';
                document.getElementById('nyomtatottLapok').value = '';
                
                ment();
                render();
                
                alert(`${cimkeDarab} db c√≠mke hozz√°adva a k√©szlethez!`);
            } else {
                alert('K√©rlek t√∂ltsd ki az √∂sszes mez≈ët!');
            }
        }

        function cimkeKeszletSzerkeszt(kulcs, illatNev, termekTipusNev, meret) {
            const jelenlegiMennyiseg = cimkeKeszlet[kulcs] || 0;
            const ujMennyiseg = prompt(`C√≠mke k√©szlet szerkeszt√©se\n\n${illatNev} - ${termekTipusNev} - ${meret}\n\nJelenlegi mennyis√©g: ${jelenlegiMennyiseg} db\n\n√öj mennyis√©g:`, jelenlegiMennyiseg);
            
            if (ujMennyiseg !== null) {
                const szam = parseInt(ujMennyiseg);
                if (!isNaN(szam) && szam >= 0) {
                    cimkeKeszlet[kulcs] = szam;
                    ment();
                    render();
                } else {
                    alert('K√©rlek adj meg egy √©rv√©nyes sz√°mot!');
                }
            }
        }

        function termekCimkezTeljes(kiontesId) {
            const kiontes = kiontesek.find(k => k.id === kiontesId);
            if (!kiontes) return;
            
            console.log('=== TELJES C√çMK√âZ√âS KEZD√âS ===');
            console.log('Term√©k:', kiontes.illatNev, '-', kiontes.darabszam, 'db');
            console.log('Jelenlegi k√©sz term√©kek sz√°ma:', keszTermekek.length);
            
            const kulcs = getCimkeKulcs(kiontes.illatId, kiontes.termekTipus, kiontes.meret);
            const keszletMennyiseg = cimkeKeszlet[kulcs] || 0;
            
            if (keszletMennyiseg < kiontes.darabszam) {
                alert(`Nincs el√©g c√≠mke a k√©szletben!\n\nSz√ºks√©ges: ${kiontes.darabszam} db\nK√©szlet: ${keszletMennyiseg} db\n\nHaszn√°ld a "R√©szleges" gombot!`);
                return;
            }
            
            if (confirm(`C√≠mk√©zel ${kiontes.darabszam} db term√©ket?`)) {
                // Levon√°s a c√≠mke k√©szletb≈ël
                cimkeKeszlet[kulcs] -= kiontes.darabszam;
                
                // √Åtker√ºl a k√©sz term√©kek k√∂z√©
                const ujTermek = {
                    ...kiontes,
                    cimkezveIdopont: new Date().toISOString()
                };
                keszTermekek.unshift(ujTermek);
                
                console.log('√öj term√©k hozz√°adva, ID:', ujTermek.id);
                console.log('K√©sz term√©kek sz√°ma ment√©s el≈ëtt:', keszTermekek.length);
                
                // T√∂rl√©s a ki√∂nt√©sek k√∂z√ºl
                kiontesek = kiontesek.filter(k => k.id !== kiontesId);
                
                ment();
                
                console.log('Ment√©s ut√°n - ellen≈ërz√©s LocalStorage-b√≥l:');
                const ellenorzes = JSON.parse(localStorage.getItem('gyertya_kesz_termekek') || '[]');
                console.log('LocalStorage-ban l√©v≈ë k√©sz term√©kek sz√°ma:', ellenorzes.length);
                console.log('=== TELJES C√çMK√âZ√âS V√âGE ===');
                
                render();
            }
        }

        function termekCimkezReszleges(kiontesId) {
            const kiontes = kiontesek.find(k => k.id === kiontesId);
            if (!kiontes) return;
            
            const kulcs = getCimkeKulcs(kiontes.illatId, kiontes.termekTipus, kiontes.meret);
            const keszletMennyiseg = cimkeKeszlet[kulcs] || 0;
            
            console.log('=== R√âSZLEGES C√çMK√âZ√âS KEZD√âS ===');
            console.log('Term√©k:', kiontes.illatNev, '-', kiontes.darabszam, 'db');
            console.log('C√≠mke k√©szlet:', keszletMennyiseg, 'db');
            console.log('Jelenlegi k√©sz term√©kek sz√°ma:', keszTermekek.length);
            
            const maxCimkezheto = Math.min(keszletMennyiseg, kiontes.darabszam);
            
            if (maxCimkezheto === 0) {
                alert('Nincs c√≠mke a k√©szletben!');
                return;
            }
            
            const mennyiseg = prompt(
                `R√©szleges c√≠mk√©z√©s\n\n` +
                `Term√©k: ${kiontes.illatNev} - ${kiontes.termekTipusNev} - ${kiontes.meret}\n` +
                `√ñsszes term√©k: ${kiontes.darabszam} db\n` +
                `C√≠mke k√©szlet: ${keszletMennyiseg} db\n\n` +
                `H√°ny darabot c√≠mk√©zel? (max ${maxCimkezheto} db)`,
                maxCimkezheto
            );
            
            if (mennyiseg !== null) {
                const szam = parseInt(mennyiseg);
                if (!isNaN(szam) && szam > 0 && szam <= maxCimkezheto) {
                    // Levon√°s a c√≠mke k√©szletb≈ël
                    cimkeKeszlet[kulcs] -= szam;
                    
                    // K√©sz term√©k l√©trehoz√°sa a c√≠mk√©zett mennyis√©ggel
                    const ujKeszTermek = {
                        ...kiontes,
                        darabszam: szam,
                        cimkezveIdopont: new Date().toISOString(),
                        id: generateId()
                    };
                    
                    console.log('√öj k√©sz term√©k l√©trehozva:', szam, 'db, ID:', ujKeszTermek.id);
                    
                    keszTermekek.unshift(ujKeszTermek);
                    
                    console.log('K√©sz term√©kek sz√°ma hozz√°ad√°s ut√°n:', keszTermekek.length);
                    
                    // Eredeti term√©k mennyis√©g√©nek cs√∂kkent√©se
                    kiontes.darabszam -= szam;
                    
                    console.log('Eredeti term√©k marad√©k:', kiontes.darabszam, 'db');
                    
                    // Ha az √∂sszes term√©k c√≠mk√©zve lett, t√∂rl√©s
                    if (kiontes.darabszam <= 0) {
                        kiontesek = kiontesek.filter(k => k.id !== kiontesId);
                        console.log('Eredeti term√©k t√∂r√∂lve (mind c√≠mk√©zve)');
                    }
                    
                    ment();
                    
                    console.log('Ment√©s ut√°n - ellen≈ërz√©s LocalStorage-b√≥l:');
                    const ellenorzes = JSON.parse(localStorage.getItem('gyertya_kesz_termekek') || '[]');
                    console.log('LocalStorage-ban l√©v≈ë k√©sz term√©kek sz√°ma:', ellenorzes.length);
                    console.log('=== R√âSZLEGES C√çMK√âZ√âS V√âGE ===');
                    
                    render();
                } else {
                    alert('√ârv√©nytelen mennyis√©g!');
                }
            }
        }

        function keszTermekTorol(id) {
            if (confirm('Biztosan t√∂rl√∂d ezt a k√©sz term√©ket?')) {
                keszTermekek = keszTermekek.filter(k => k.id !== id);
                ment();
                render();
            }
        }

        function csoportTorol(illatNev, termekTipusNev, meret) {
            if (confirm(`Biztosan t√∂rl√∂d az √∂sszes k√©sz term√©ket ebb≈ël: ${illatNev} - ${termekTipusNev} - ${meret}?`)) {
                // T√∂rl√©s a csoportb√≥l - minden t√©tel ami megegyezik
                keszTermekek = keszTermekek.filter(k => 
                    !(k.illatNev === illatNev && k.termekTipusNev === termekTipusNev && k.meret === meret)
                );
                ment();
                render();
            }
        }

        function updateMeretOptions() {
            const termekTipus = document.getElementById('termekTipus').value;
            const meretSelect = document.getElementById('meret');
            
            if (termekTipus && meretek[termekTipus]) {
                meretSelect.innerHTML = '<option value="">V√°lassz m√©retet...</option>' +
                    meretek[termekTipus].map(m => `<option value="${m}">${m}</option>`).join('');
            } else {
                meretSelect.innerHTML = '<option value="">El≈ësz√∂r v√°lassz term√©k t√≠pust</option>';
            }
        }

        function toggleUjIllat() {
            const form = document.getElementById('ujIllatForm');
            form.classList.toggle('hidden');
            if (!form.classList.contains('hidden')) {
                document.getElementById('ujIllatNev').focus();
            }
        }

        function illatHozzaad() {
            const nev = document.getElementById('ujIllatNev').value.trim();
            if (nev) {
                illatok.push({ id: generateId(), nev });
                document.getElementById('ujIllatNev').value = '';
                toggleUjIllat();
                ment();
                render();
            }
        }

        function illatTorol(id) {
            if (confirm('Biztosan t√∂rl√∂d ezt az illatot?')) {
                illatok = illatok.filter(i => i.id !== id);
                ment();
                render();
            }
        }

        function kiontesHozzaad() {
            const termekTipus = document.getElementById('termekTipus').value;
            const meret = document.getElementById('meret').value;
            const illatId = parseInt(document.getElementById('kivalasztottIllat').value);
            const darab = parseInt(document.getElementById('darabszam').value);
            const megj = document.getElementById('megjegyzes').value.trim();
            
            if (termekTipus && meret && illatId && darab > 0) {
                const illat = illatok.find(i => i.id === illatId);
                const termekTipusObj = termekTipusok.find(t => t.id === termekTipus);
                
                kiontesek.unshift({
                    id: generateId(),
                    termekTipus: termekTipus,
                    termekTipusNev: termekTipusObj.nev,
                    meret: meret,
                    illatId,
                    illatNev: illat.nev,
                    darabszam: darab,
                    datum: new Date().toISOString(),
                    megjegyzes: megj,
                    cimkeGyartva: false
                });
                
                document.getElementById('termekTipus').value = '';
                document.getElementById('meret').innerHTML = '<option value="">El≈ësz√∂r v√°lassz term√©k t√≠pust</option>';
                document.getElementById('kivalasztottIllat').value = '';
                document.getElementById('darabszam').value = '';
                document.getElementById('megjegyzes').value = '';
                
                ment();
                render();
            } else {
                alert('K√©rlek t√∂ltsd ki az √∂sszes k√∂telez≈ë mez≈ët!');
            }
        }

        function cimkeToggle(id) {
            const kiontes = kiontesek.find(k => k.id === id);
            if (kiontes) {
                kiontes.cimkeGyartva = !kiontes.cimkeGyartva;
                // Ha most lett k√©sz a c√≠mke, r√∂gz√≠tj√ºk a d√°tumot
                if (kiontes.cimkeGyartva) {
                    kiontes.cimkeGyartvaIdopont = new Date().toISOString();
                } else {
                    // Ha visszav√°ltjuk "nincs k√©sz" √°llapotra, t√∂r√∂lj√ºk a d√°tumot
                    delete kiontes.cimkeGyartvaIdopont;
                }
                ment();
                render();
            }
        }

        function kiontesTorol(id) {
            if (confirm('Biztosan t√∂rl√∂d ezt a ki√∂nt√©st?')) {
                kiontesek = kiontesek.filter(k => k.id !== id);
                ment();
                render();
            }
        }

        function formatDatum(isoString) {
            const date = new Date(isoString);
            const options = { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return date.toLocaleDateString('hu-HU', options);
        }

        function render() {
            // Illat lista
            const illatLista = document.getElementById('illatLista');
            if (illatok.length === 0) {
                illatLista.innerHTML = '<p class="text-gray-500 text-center py-8">M√©g nincs illat hozz√°adva</p>';
            } else {
                illatLista.innerHTML = illatok.map(illat => `
                    <div class="flex justify-between items-center p-3 bg-amber-50 rounded-lg hover:bg-amber-100 transition">
                        <span class="font-medium text-amber-900">${illat.nev}</span>
                        <button onclick="illatTorol(${illat.id})" class="text-red-600 hover:text-red-800 text-sm">
                            T√∂rl√©s
                        </button>
                    </div>
                `).join('');
            }

            // Term√©k t√≠pus select
            const termekTipusSelect = document.getElementById('termekTipus');
            if (termekTipusSelect) {
                termekTipusSelect.innerHTML = '<option value="">V√°lassz term√©k t√≠pust...</option>' +
                    termekTipusok.map(t => `<option value="${t.id}">${t.nev}</option>`).join('');
            }

            // Illat select
            const select = document.getElementById('kivalasztottIllat');
            select.innerHTML = '<option value="">V√°lassz illatot...</option>' + 
                illatok.map(illat => `<option value="${illat.id}">${illat.nev}</option>`).join('');

            // Nyomtat√°s illat select
            const nyomtatasIllatSelect = document.getElementById('nyomtatasIllat');
            if (nyomtatasIllatSelect) {
                nyomtatasIllatSelect.innerHTML = '<option value="">V√°lassz illatot...</option>' + 
                    illatok.map(illat => `<option value="${illat.id}">${illat.nev}</option>`).join('');
            }

            // Nyomtat√°s term√©k t√≠pus select
            const nyomtatasTermekSelect = document.getElementById('nyomtatasTermekTipus');
            if (nyomtatasTermekSelect) {
                nyomtatasTermekSelect.innerHTML = '<option value="">V√°lassz term√©k t√≠pust...</option>' +
                    termekTipusok.map(t => `<option value="${t.id}">${t.nev}</option>`).join('');
            }

            // Gyors nyomtat√°s lista - ki√∂nt√∂tt term√©kek alapj√°n
            const gyorsNyomtatasLista = document.getElementById('gyorsNyomtatasLista');
            if (gyorsNyomtatasLista) {
                // Egyedi kombin√°ci√≥k gy≈±jt√©se
                const kombinaciok = new Map();
                
                kiontesek.forEach(k => {
                    if (k.termekTipusNev && k.meret) {
                        const kulcs = `${k.illatId}-${k.termekTipus}-${k.meret}`;
                        if (!kombinaciok.has(kulcs)) {
                            kombinaciok.set(kulcs, {
                                illatId: k.illatId,
                                illatNev: k.illatNev,
                                termekTipus: k.termekTipus,
                                termekTipusNev: k.termekTipusNev,
                                meret: k.meret,
                                osszesTermek: 0
                            });
                        }
                        kombinaciok.get(kulcs).osszesTermek += k.darabszam;
                    }
                });
                
                const kombinaciokTomb = Array.from(kombinaciok.values());
                
                if (kombinaciokTomb.length === 0) {
                    gyorsNyomtatasLista.innerHTML = '<p class="text-gray-500 text-sm">Nincs ki√∂nt√∂tt term√©k</p>';
                } else {
                    gyorsNyomtatasLista.innerHTML = kombinaciokTomb.map(komb–æ => {
                        const cimkeKulcs = getCimkeKulcs(komb–æ.illatId, komb–æ.termekTipus, komb–æ.meret);
                        const keszlet = cimkeKeszlet[cimkeKulcs] || 0;
                        const hianyzo = Math.max(0, komb–æ.osszesTermek - keszlet);
                        const ajanlottLapok = Math.ceil(hianyzo / 12);
                        
                        return `
                            <div class="p-3 rounded border ${hianyzo > 0 ? 'bg-orange-50 border-orange-300' : 'bg-green-50 border-green-300'}">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex-1">
                                        <div class="font-medium text-sm">${komb–æ.illatNev}</div>
                                        <div class="text-xs text-gray-600">${komb–æ.termekTipusNev} - ${komb–æ.meret}</div>
                                        <div class="text-xs mt-1">
                                            <span class="text-gray-600">Term√©k: ${komb–æ.osszesTermek} db</span> | 
                                            <span class="${keszlet > 0 ? 'text-green-600' : 'text-gray-600'}">C√≠mke: ${keszlet} db</span>
                                        </div>
                                        ${hianyzo > 0 ? `<div class="text-xs font-bold text-orange-700 mt-1">‚ö†Ô∏è Hi√°nyzik: ${hianyzo} db (${ajanlottLapok} lap)</div>` : ''}
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <input type="number" id="lapok-${komb–æ.illatId}-${komb–æ.termekTipus}-${komb–æ.meret}" min="1" value="${ajanlottLapok || 1}" 
                                        class="w-20 px-2 py-1 text-sm border rounded" placeholder="Lapok">
                                    <button onclick="gyorsNyomtatas(${komb–æ.illatId}, '${komb–æ.termekTipus}', '${komb–æ.meret}')" 
                                        class="flex-1 px-3 py-1 text-sm rounded ${hianyzo > 0 ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-500 hover:bg-gray-600'} text-white">
                                        üñ®Ô∏è Nyomtat
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }

            // C√≠mke k√©szlet lista - MINDIG L√ÅTSZIK
            const cimkeKeszletLista = document.getElementById('cimkeKeszletLista');
            if (cimkeKeszletLista) {
                const keszletHTML = [];
                
                // El≈ësz√∂r gy≈±jtj√ºk √∂ssze az √ñSSZES kombin√°ci√≥t (ki√∂nt√∂tt + k√©szlet)
                const osszesKombinacio = new Map();
                
                // 1. Ki√∂nt√∂tt term√©kek kombin√°ci√≥i
                kiontesek.forEach(k => {
                    if (k.termekTipusNev && k.meret) {
                        const kulcs = getCimkeKulcs(k.illatId, k.termekTipus, k.meret);
                        if (!osszesKombinacio.has(kulcs)) {
                            osszesKombinacio.set(kulcs, {
                                illatId: k.illatId,
                                illatNev: k.illatNev,
                                termekTipus: k.termekTipus,
                                termekTipusNev: k.termekTipusNev,
                                meret: k.meret,
                                kulcs: kulcs
                            });
                        }
                    }
                });
                
                // 2. C√≠mke k√©szletben l√©v≈ë kombin√°ci√≥k (amikhez m√°r nincs term√©k)
                for (let kulcs in cimkeKeszlet) {
                    if (cimkeKeszlet[kulcs] > 0 && !osszesKombinacio.has(kulcs)) {
                        const [illatId, termekTipus, meret] = kulcs.split('-');
                        const illat = illatok.find(i => i.id === parseInt(illatId));
                        const termekTipusObj = termekTipusok.find(t => t.id === termekTipus);
                        
                        if (illat && termekTipusObj) {
                            osszesKombinacio.set(kulcs, {
                                illatId: parseInt(illatId),
                                illatNev: illat.nev,
                                termekTipus: termekTipus,
                                termekTipusNev: termekTipusObj.nev,
                                meret: meret,
                                kulcs: kulcs
                            });
                        }
                    }
                }
                
                // Rendez√©s √©s megjelen√≠t√©s
                Array.from(osszesKombinacio.values()).forEach(info => {
                    const mennyiseg = cimkeKeszlet[info.kulcs] || 0;
                    const cssClass = mennyiseg < 12 ? 'bg-red-50 border-red-300' : mennyiseg === 0 ? 'bg-gray-50 border-gray-300' : 'bg-green-50 border-green-300';
                    
                    keszletHTML.push(`
                        <div class="p-3 rounded border ${cssClass}">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="font-medium text-sm">${info.illatNev}</div>
                                    <div class="text-xs text-gray-600">${info.termekTipusNev} - ${info.meret}</div>
                                    <div class="font-bold mt-1 ${mennyiseg < 12 && mennyiseg > 0 ? 'text-red-700' : mennyiseg === 0 ? 'text-gray-500' : 'text-green-700'}">${mennyiseg} db</div>
                                </div>
                                <button onclick="cimkeKeszletSzerkeszt('${info.kulcs}', '${info.illatNev}', '${info.termekTipusNev}', '${info.meret}')" class="text-blue-600 hover:text-blue-800 text-xs">
                                    ‚úèÔ∏è Szerkeszt
                                </button>
                            </div>
                        </div>
                    `);
                });
                
                if (keszletHTML.length === 0) {
                    cimkeKeszletLista.innerHTML = '<p class="text-gray-500 text-sm">M√©g nincs c√≠mke k√©szlet</p>';
                } else {
                    cimkeKeszletLista.innerHTML = keszletHTML.join('');
                }
            }

            // √ñsszes√≠t√©s term√©k t√≠pusonk√©nt, m√©retenk√©nt √©s illatonk√©nt
            const osszesitesMap = new Map();
            
            kiontesek.forEach(k => {
                // Csak azokat dolgozzuk fel, amiknek van termekTipusNev √©s meret (√∫j form√°tum)
                if (k.termekTipusNev && k.meret) {
                    const kulcs = `${k.termekTipusNev}|${k.meret}|${k.illatNev}`;
                    if (!osszesitesMap.has(kulcs)) {
                        osszesitesMap.set(kulcs, {
                            termekTipusNev: k.termekTipusNev,
                            meret: k.meret,
                            illatNev: k.illatNev,
                            illatId: k.illatId,
                            termekTipus: k.termekTipus,
                            osszesDarab: 0,
                            cimkeNelkul: 0
                        });
                    }
                    const item = osszesitesMap.get(kulcs);
                    item.osszesDarab += k.darabszam;
                    if (!k.cimkeGyartva) {
                        item.cimkeNelkul += k.darabszam;
                    }
                }
            });

            const osszesites = Array.from(osszesitesMap.values());

            const cimkeDiv = document.getElementById('cimkeOsszesites');
            if (osszesites.length > 0) {
                cimkeDiv.innerHTML = `
                    <div class="bg-gradient-to-r from-green-600 to-emerald-600 rounded-xl shadow-lg p-6 text-white">
                        <h2 class="text-2xl font-bold mb-4">üìã C√≠mk√©k gy√°rt√°sa</h2>
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${osszesites.map(item => {
                                // C√≠mke k√©szlet lek√©r√©se erre a kombin√°ci√≥ra
                                const cimkeKulcs = getCimkeKulcs(item.illatId, item.termekTipus, item.meret);
                                const keszlet = cimkeKeszlet[cimkeKulcs] || 0;
                                const hianyzo = Math.max(0, item.cimkeNelkul - keszlet);
                                
                                return `
                                <div class="bg-white/20 backdrop-blur rounded-lg p-4">
                                    <div class="font-bold text-lg mb-1">${item.illatNev}</div>
                                    <div class="text-sm opacity-90">${item.termekTipusNev} - ${item.meret}</div>
                                    <div class="text-sm opacity-90 mt-1">Term√©k: ${item.cimkeNelkul} db</div>
                                    <div class="text-sm opacity-90">C√≠mke k√©szlet: ${keszlet} db</div>
                                    ${hianyzo > 0 ? `
                                        <div class="text-xl font-bold mt-2 bg-yellow-400 text-yellow-900 rounded px-2 py-1 inline-block">
                                            ‚ö†Ô∏è ${hianyzo} db c√≠mke kell
                                        </div>
                                    ` : item.cimkeNelkul > 0 ? `
                                        <div class="text-sm mt-2 bg-blue-400 text-blue-900 rounded px-2 py-1 inline-block">
                                            ‚úì Van el√©g c√≠mke (${keszlet} db)
                                        </div>
                                    ` : `
                                        <div class="text-sm mt-2 bg-green-800 rounded px-2 py-1 inline-block">
                                            ‚úì Minden term√©k c√≠mk√©zve
                                        </div>
                                    `}
                                </div>
                            `;}).join('')}
                        </div>
                    </div>
                `;
            } else {
                cimkeDiv.innerHTML = '';
            }

            // Ki√∂nt√©sek lista
            const kiontesLista = document.getElementById('kiontesLista');
            if (kiontesek.length === 0) {
                kiontesLista.innerHTML = '<p class="text-gray-500 text-center py-8">M√©g nincs term√©k r√∂gz√≠tve</p>';
            } else {
                kiontesLista.innerHTML = kiontesek.map(kiontes => {
                    const kulcs = getCimkeKulcs(kiontes.illatId, kiontes.termekTipus, kiontes.meret);
                    const keszletMennyiseg = cimkeKeszlet[kulcs] || 0;
                    const eleg = keszletMennyiseg >= kiontes.darabszam;
                    
                    return `
                    <div class="p-4 rounded-lg border-2 transition ${
                        kiontes.cimkeGyartva ? 'bg-green-50 border-green-300' : 'bg-orange-50 border-orange-300'
                    }">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <div class="font-bold text-lg text-amber-900">${kiontes.illatNev}</div>
                                ${kiontes.termekTipusNev ? `<div class="text-sm text-gray-700 font-medium">${kiontes.termekTipusNev} - ${kiontes.meret}</div>` : ''}
                                <div class="text-xs text-gray-500 mt-1">üóìÔ∏è Ki√∂ntve: ${formatDatum(kiontes.datum)}</div>
                                ${kiontes.cimkeGyartva && kiontes.cimkeGyartvaIdopont ? `<div class="text-xs text-green-700 mt-0.5">‚úì C√≠mke k√©sz: ${formatDatum(kiontes.cimkeGyartvaIdopont)}</div>` : ''}
                                <div class="text-xs mt-1 ${eleg ? 'text-green-600' : 'text-red-600'}">
                                    üìã C√≠mke k√©szlet: ${keszletMennyiseg} db ${!eleg ? '(NINCS EL√âG!)' : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-amber-900">${kiontes.darabszam} db</div>
                            </div>
                        </div>
                        ${kiontes.megjegyzes ? `<div class="text-sm text-gray-600 mb-2 italic">üìù ${kiontes.megjegyzes}</div>` : ''}
                        <div class="flex gap-2 mt-3">
                            <button onclick="termekCimkezTeljes(${kiontes.id})" class="flex-1 px-4 py-2 rounded-lg font-medium transition ${
                                eleg ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-gray-400 text-white cursor-not-allowed'
                            }" ${!eleg ? 'disabled' : ''}>
                                ‚úì Mind (${kiontes.darabszam} db)
                            </button>
                            <button onclick="termekCimkezReszleges(${kiontes.id})" class="flex-1 px-4 py-2 rounded-lg font-medium transition bg-purple-600 text-white hover:bg-purple-700">
                                üè∑Ô∏è R√©szleges
                            </button>
                            <button onclick="kiontesTorol(${kiontes.id})" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                                T√∂rl√©s
                            </button>
                        </div>
                    </div>
                `;
                }).join('');
            }

            // K√©sz term√©kek lista - CSOPORTOS√çTVA - KOMPAKT
            const keszTermekekLista = document.getElementById('keszTermekekLista');
            if (keszTermekekLista) {
                if (keszTermekek.length === 0) {
                    keszTermekekLista.innerHTML = '<p class="text-gray-500 text-center py-8">M√©g nincs k√©sz c√≠mk√©zett term√©k</p>';
                } else {
                    // Csoportos√≠t√°s illat+t√≠pus+m√©ret szerint
                    const csoportositott = {};
                    
                    keszTermekek.forEach(termek => {
                        const kulcs = `${termek.illatId}-${termek.termekTipus}-${termek.meret}`;
                        
                        if (!csoportositott[kulcs]) {
                            csoportositott[kulcs] = {
                                illatNev: termek.illatNev,
                                termekTipusNev: termek.termekTipusNev,
                                meret: termek.meret,
                                osszesDarab: 0,
                                elsoKiontesIdopont: termek.datum,
                                utolsoCimkezesIdopont: termek.cimkezveIdopont,
                                megjegyzes: termek.megjegyzes,
                                tetelek: []
                            };
                        }
                        
                        csoportositott[kulcs].osszesDarab += termek.darabszam;
                        csoportositott[kulcs].tetelek.push(termek);
                        
                        // Legkor√°bbi ki√∂nt√©s √©s legutols√≥ c√≠mk√©z√©s d√°tuma
                        if (new Date(termek.datum) < new Date(csoportositott[kulcs].elsoKiontesIdopont)) {
                            csoportositott[kulcs].elsoKiontesIdopont = termek.datum;
                        }
                        if (new Date(termek.cimkezveIdopont) > new Date(csoportositott[kulcs].utolsoCimkezesIdopont)) {
                            csoportositott[kulcs].utolsoCimkezesIdopont = termek.cimkezveIdopont;
                        }
                    });
                    
                    const csoportositottTomb = Object.values(csoportositott);
                    
                    // KOMPAKT t√°bl√°zat st√≠lus
                    keszTermekekLista.innerHTML = `
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-emerald-100 border-b-2 border-emerald-300">
                                    <tr>
                                        <th class="text-left p-2 font-semibold text-emerald-900">Illat</th>
                                        <th class="text-left p-2 font-semibold text-emerald-900">T√≠pus / M√©ret</th>
                                        <th class="text-center p-2 font-semibold text-emerald-900">Darab</th>
                                        <th class="text-center p-2 font-semibold text-emerald-900">C√≠mk√©zve</th>
                                        <th class="text-center p-2 font-semibold text-emerald-900"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${csoportositottTomb.map(csoport => `
                                        <tr class="border-b border-emerald-200 hover:bg-emerald-50">
                                            <td class="p-2 font-medium text-emerald-900">${csoport.illatNev}</td>
                                            <td class="p-2 text-gray-700">${csoport.termekTipusNev} - ${csoport.meret}</td>
                                            <td class="p-2 text-center font-bold text-emerald-900">${csoport.osszesDarab} db</td>
                                            <td class="p-2 text-center text-xs text-gray-600">${formatDatum(csoport.utolsoCimkezesIdopont)}</td>
                                            <td class="p-2 text-center">
                                                <button onclick="csoportTorol('${csoport.illatNev}', '${csoport.termekTipusNev}', '${csoport.meret}')" 
                                                    class="text-red-600 hover:text-red-800 text-xs px-2 py-1">
                                                    T√∂rl√©s
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            }
        }

        // Enter billenty≈± kezel√©s
        document.addEventListener('DOMContentLoaded', () => {
            betolt();
            
            document.getElementById('ujIllatNev').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') illatHozzaad();
            });
        });
    </script>
</body>
</html>